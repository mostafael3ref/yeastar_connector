{
  "doctype": "DocType",
  "name": "Yeastar Settings",
  "module": "yeastar_connector",
  "custom": 0,
  "istable": 0,
  "issingle": 1,
  "editable_grid": 0,
  "quick_entry": 0,
  "track_changes": 1,
  "fields": [
    {
      "fieldname": "enabled",
      "fieldtype": "Check",
      "label": "Enabled",
      "default": "0"
    },

    {
      "fieldname": "section_webhook",
      "fieldtype": "Section Break",
      "label": "Webhook"
    },
    {
      "fieldname": "webhook_secret",
      "fieldtype": "Password",
      "label": "Webhook Secret",
      "reqd": 1,
      "depends_on": "eval:doc.enabled==1"
    },
    {
      "fieldname": "phone_country_code",
      "fieldtype": "Data",
      "label": "Phone Country Code",
      "default": "+966"
    },
    {
      "fieldname": "create_lead_if_not_found",
      "fieldtype": "Check",
      "label": "Create Lead If Not Found",
      "default": "1"
    },
    {
      "fieldname": "ignore_internal_calls",
      "fieldtype": "Check",
      "label": "Ignore Internal Calls",
      "default": "1"
    },

    {
      "fieldname": "section_api",
      "fieldtype": "Section Break",
      "label": "Yeastar API (OpenAPI)"
    },
    {
      "fieldname": "pbx_base_url",
      "fieldtype": "Data",
      "label": "PBX Base URL",
      "description": "Example: https://abragtaj.ras.yeastar.com",
      "depends_on": "eval:doc.enabled==1"
    },
    {
      "fieldname": "api_base_path",
      "fieldtype": "Data",
      "label": "API Base Path",
      "default": "/openapi/v1.0",
      "depends_on": "eval:doc.enabled==1"
    },
    {
      "fieldname": "token_url",
      "fieldtype": "Data",
      "label": "Token URL (optional)",
      "description": "Leave empty to use: <PBX Base URL><API Base Path>/get_token",
      "depends_on": "eval:doc.enabled==1"
    },

    {
      "fieldname": "api_username",
      "fieldtype": "Data",
      "label": "API Username (Client ID)",
      "depends_on": "eval:doc.enabled==1"
    },
    {
      "fieldname": "api_password",
      "fieldtype": "Password",
      "label": "API Password (Client Secret)",
      "depends_on": "eval:doc.enabled==1"
    },

    {
      "fieldname": "column_api_token",
      "fieldtype": "Column Break"
    },
    {
      "fieldname": "access_token",
      "fieldtype": "Data",
      "label": "Access Token (auto)",
      "read_only": 1
    },
    {
      "fieldname": "refresh_token",
      "fieldtype": "Data",
      "label": "Refresh Token (auto)",
      "read_only": 1
    },
    {
      "fieldname": "token_expires_at_ts",
      "fieldtype": "Int",
      "label": "Token Expires At (TS)",
      "read_only": 1
    },
    {
      "fieldname": "request_timeout",
      "fieldtype": "Int",
      "label": "Request Timeout (seconds)",
      "default": "20"
    },

    {
      "fieldname": "section_sync",
      "fieldtype": "Section Break",
      "label": "Sync Settings"
    },
    {
      "fieldname": "sync_enabled",
      "fieldtype": "Check",
      "label": "Enable Sync Jobs",
      "default": "0",
      "depends_on": "eval:doc.enabled==1"
    },
    {
      "fieldname": "sync_extensions",
      "fieldtype": "Check",
      "label": "Sync Extensions",
      "default": "1",
      "depends_on": "eval:doc.sync_enabled==1"
    },
    {
      "fieldname": "auto_link_crm",
      "fieldtype": "Check",
      "label": "Auto Link CRM (Lead/Customer)",
      "default": "1",
      "depends_on": "eval:doc.sync_enabled==1"
    },
    {
      "fieldname": "page_size",
      "fieldtype": "Int",
      "label": "Page Size",
      "default": "100",
      "depends_on": "eval:doc.sync_enabled==1"
    },
    {
      "fieldname": "last_sync_at_ts",
      "fieldtype": "Int",
      "label": "Last Sync At (TS)",
      "read_only": 1
    },
    {
      "fieldname": "sync_from_ts",
      "fieldtype": "Int",
      "label": "Sync From (TS) - First run only",
      "description": "If empty, defaults to last 24h",
      "depends_on": "eval:doc.sync_enabled==1"
    },

    {
      "fieldname": "section_endpoints",
      "fieldtype": "Section Break",
      "label": "Endpoints (Optional Overrides)"
    },
    {
      "fieldname": "extensions_endpoint",
      "fieldtype": "Data",
      "label": "Extensions Endpoint",
      "default": "/extension/list",
      "depends_on": "eval:doc.sync_enabled==1"
    },
    {
      "fieldname": "call_logs_endpoint",
      "fieldtype": "Data",
      "label": "Call Logs Endpoint (CDR)",
      "default": "/cdr/list",
      "depends_on": "eval:doc.sync_enabled==1"
    },
    {
      "fieldname": "recording_endpoint_tpl",
      "fieldtype": "Data",
      "label": "Recording Endpoint",
      "default": "/recording/get",
      "depends_on": "eval:doc.sync_enabled==1"
    }
  ],
  "permissions": [
    {
      "role": "System Manager",
      "read": 1,
      "write": 1,
      "create": 1,
      "delete": 1
    }
  ],
  "sort_field": "modified",
  "sort_order": "DESC"
}
